name: autoProfile

on:
  workflow_dispatch:
  schedule:
    - cron: "0 20 */7 * *"

jobs:
  autoProfile:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - name: Get Profile File
      run: |
        curl -o Outbound.conf https://raw.githubusercontent.com/DivineEngine/Profiles/master/Quantumult/Outbound.conf
        cp Outbound.conf profiles.conf
        time=$(date -u "+%Y-%m-%dT%H:%M:%SZ")
        var="#${time}"
        sed -i "1i\\$var" profiles.conf
        sed -i 's/;running_mode_trigger=filter, filter, LINK_22E171:all_proxy, LINK_22E172:all_direct/running_mode_trigger=filter, filter, LY-Dormitory:all_direct, LY-Office:all_direct/' profiles.conf        
        sed -i 's/;no-system/no-system/' profiles.conf
        sed -i 's/no-ipv6/;no-ipv6/' profiles.conf
        sed -i '/# 你可以设置 update-interval=172800 来自定义你的自动同步时间间隔(秒)，负数表示禁用自动同步。/a\ServerLocal.snippet, tag=VPS, update-interval=172800, opt-parser=false, enabled=true' profiles.conf
        sed -i 's/;passphrase =/passphrase = 38D0C372/' profiles.conf
        sed -i 's#;p12 =#p12 = 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#' profiles.conf
        mv profiles.conf quantumultX_profiles.conf
        
    - name: Commit files
      run: |
        git add .
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git commit -m "Github Action Auto Refresh" -a
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}
